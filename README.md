
<!-- README.md is generated from README.Rmd. Please edit that file -->

# streamflow

The streamflow package let’s users classify streams as being wet or dry
using time-series data generated by sensors. The package should be
considered an *alpha* release but we would love to hear any feedback,
feature requests, or bug reports that you might encounter.

## Installation

The streamflow package is not yet on CRAN but you can download and
install the current working version from github using the following:

``` r
# Install the remotes package if you haven't already.
# install.packages(remotes)
remotes::install_github("jimmylovestea/streamflow")
```

After installing, load the package into your R environment using

``` r
library(streamflow)
```

## Example usage

The package includes a dataset from the Willow Whitehorse creek area in
Oregon. The data includes resistor and water temperature sensor readings
for 10 different sites recorded in 2015 between the Spring and late
Summer.

For this data, the first 6 rows look as
follows:

| date\_time          | site\_id | sensor\_type | sensor\_reading | initial\_state | final\_state |
| :------------------ | :------- | :----------- | --------------: | :------------- | :----------- |
| 2015-04-01 08:00:00 | 10210    | Water temp   |         \-8.331 | dry            | dry          |
| 2015-04-01 09:00:00 | 10210    | Water temp   |         \-0.032 | dry            | dry          |
| 2015-04-01 10:00:00 | 10210    | Water temp   |           2.770 | dry            | dry          |
| 2015-04-01 11:00:00 | 10210    | Water temp   |           7.444 | dry            | dry          |
| 2015-04-01 12:00:00 | 10210    | Water temp   |          12.654 | dry            | dry          |
| 2015-04-01 13:00:00 | 10210    | Water temp   |          16.439 | dry            | dry          |

A few things to notice here are that the `date_time` variable is a
`POSIX` class variable, meaning it has information about both the date
and time of the sensor reading. Also of imporance is to note that there
are two types of sensors in the `sensor_type`. The names of these
sensors are

``` r
unique(wwc$sensor_type)
#> [1] "Water temp" "Resistor"
```

Finally, note that the initial and end state of the stream is noted in
the data but this information is not required for the functions to work.

Once your raw data has a similar structure as the example data, you’ll
need to further format your data in order for the classification methods
to work. To do so, you can run:

``` r
formatted_wwc <- format_data(data = wwc,
                             date_var = "date_time",
                             date_start = "2015-04-01",
                             date_end = "2015-08-30",
                             site_id_var = "site_id",
                             sensor_type_var = "sensor_type",
                             resistor_level = "Resistor",
                             water_temp_level = "Water temp",
                             sensor_reading_var = "sensor_reading")
```

The function arguments `date_var`, `site_id_var`, `sensor_type_var`, and
`sensor_reading_var` should each be the name of the variables in the
data which contain their respective information. You can subset your
data to include specific time-periods by specifying `date_start` and
`date_end`. You’ll also need to include the names of the sensors from
`sensor_type_var` in the `resistor_level` and `water_temp_level`
arguments.

Once your data is formatted, it will be formatted so that each row
represents one days worth of sensor readings for each sensor. It will
also include the mean resistor reading for the day along with the hourly
temperature readings from the water temperature sensor as columns.

Right now, the package ships with one classification method (though more
are in the works). This classification method requires *centers* for the
wet and dry streams to be computed. To compute these centers,
run:

``` r
centers <- compute_centers(data = formatted_wwc, daily_mean_resistor = "daily_mean_resistor")
#> Checking if multiple centers exist.
#> Returning one center vector.
#> Checking if multiple centers exist.
#> Returning one center vector.
centers
#> $dry_center
#>  hour_0  hour_1  hour_2  hour_3  hour_4  hour_5  hour_6  hour_7  hour_8 
#>  15.079  13.954  13.137  12.558  11.783  11.297  10.980  12.098  13.954 
#>  hour_9 hour_10 hour_11 hour_12 hour_13 hour_14 hour_15 hour_16 hour_17 
#>  15.533  20.889  27.259  31.281  36.362  34.229  31.433  28.493  26.769 
#> hour_18 hour_19 hour_20 hour_21 hour_22 hour_23 
#>  24.871  22.681  20.770  18.794  16.677  16.106 
#> 
#> $wet_center
#>  hour_0  hour_1  hour_2  hour_3  hour_4  hour_5  hour_6  hour_7  hour_8 
#>  15.605  14.888  14.170  13.570  12.992  12.558  12.195  11.953  11.807 
#>  hour_9 hour_10 hour_11 hour_12 hour_13 hour_14 hour_15 hour_16 hour_17 
#>  12.147  13.064  14.170  15.008  16.344  17.605  18.295  19.103  19.270 
#> hour_18 hour_19 hour_20 hour_21 hour_22 hour_23 
#>  18.842  18.533  18.129  17.296  16.463  15.724
```

The *centers* are used in the classification method and both the wet and
dry centers cover the 24 hours of a day.

Having computed the centers, we can now classify the data
using:

``` r
classifications <- classify_streams(data = formatted_wwc, centers = centers)
head(classifications)
#> [1] 1.619443 1.691937 1.923863 1.677848 1.702385 1.547853
```

The returned values by default are numeric where values greater than one
indicate the stream was “Dry” and values less than one indicate the
stream was “Wet”. Alternatively, you can have the “Wet” and “Dry” labels
returned directly by specifying `labels =
TRUE`:

``` r
classifications <- classify_streams(data = formatted_wwc, centers = centers, labels = TRUE)
head(classifications)
#> [1] "Dry" "Dry" "Dry" "Dry" "Dry" "Dry"
```

## Summarizing the classifications

For the Willow Whitehorse Creek data, we can verify the performance of
the classification method by comparing the output of `classify_streams`
to the resistor sensor
readings:

``` r
# Compute the predicted status of the stream using the classification method
predicted_status <- classify_streams(data = formatted_wwc, centers = centers, labels = TRUE)

# Compute the acutal status of the stream using the resistor readings
actual_status <- ifelse(formatted_wwc$daily_mean_resistor >= 0, "Wet", "Dry")

# Compare the predicted and actual status readings
table(actual_status, predicted_status)
#>              predicted_status
#> actual_status Dry Wet
#>           Dry 635  58
#>           Wet  46 739
```

## Future development plans

In the future, we plan to include in this package:

  - Additional classification methods and additional methods to compute
    the *centers* of the time series.
  - Plotting and summary methods to more easily summarize the results
    for users.

If there’s methods you would like to see implemented, drop us an email
or file an issue on the Github repo.
